<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dry Eye Analysis | NAYAN-AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="bi bi-eye-fill me-2"></i>NAYAN-AI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="bi bi-house-door me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cataract.html"><i class="bi bi-camera me-1"></i>Cataract</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="dryeye.html"><i class="bi bi-droplet me-1"></i>Dry Eye</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="history.html"><i class="bi bi-clock-history me-1"></i>History</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Disclaimer -->
    <div class="alert alert-warning mb-0 rounded-0 text-center small">
        <i class="bi bi-exclamation-triangle-fill me-1"></i>
        <strong>Disclaimer:</strong> Screening support only. Not a medical diagnosis. Consult an ophthalmologist.
    </div>

    <!-- Page Header -->
    <section class="bg-info text-white py-4">
        <div class="container">
            <h1 class="mb-2"><i class="bi bi-droplet-fill me-2"></i>Dry Eye Detection</h1>
            <p class="lead mb-0">Upload a video to analyze blink patterns and assess dry eye risk</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Instructions Card -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-info-circle me-2 text-info"></i>Instructions</h5>
                        <p class="mb-0">Record a 20-60 second video of your eye in good lighting. The system will analyze your blink patterns and provide dry eye risk assessment.</p>
                    </div>
                </div>

                <!-- Video Upload Form -->
                <div class="card border-0 shadow">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Upload Eye Video</h5>
                        
                        <form id="dryeyeForm">
                            <!-- File Input -->
                            <div class="mb-4">
                                <label for="videoInput" class="form-label fw-bold">Select or record a video</label>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="videoInput" accept="video/*" capture="environment" required>
                                    <label class="input-group-text" for="videoInput"><i class="bi bi-cloud-upload"></i></label>
                                </div>
                                <small class="text-muted d-block mt-2">Max file size: 100MB â€¢ Formats: MP4, WebM, MOV</small>
                            </div>

                            <!-- File Preview -->
                            <div id="videoPreview" style="display: none;" class="mb-4">
                                <p class="text-muted small"><strong>Selected File:</strong> <span id="fileName"></span></p>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-info w-100 py-2 fw-bold">
                                <i class="bi bi-play-circle me-2"></i>Upload & Analyze
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" style="display: none;" class="card mt-4 border-0 shadow text-center py-5">
                    <div class="spinner-border text-info mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h6 class="text-muted">Processing video frames...</h6>
                    <p class="text-muted small">This may take a few moments</p>
                </div>

                <!-- Results Card -->
                <div id="resultsCard" style="display: none;" class="card mt-4 border-0 shadow">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Analysis Results</h5>
                        
                        <!-- Risk Badge -->
                        <div class="alert alert-info mb-4" id="riskAlert">
                            <h6 class="alert-heading" id="riskLabel">Normal</h6>
                        </div>

                        <!-- Metrics Grid -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="metric-card p-3 bg-light rounded">
                                    <small class="text-muted">Blink Count</small>
                                    <h4 id="blinkCount" class="mb-0 text-primary">0</h4>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="metric-card p-3 bg-light rounded">
                                    <small class="text-muted">Blink Rate (BPM)</small>
                                    <h4 id="blinkRate" class="mb-0 text-primary">0.0</h4>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="metric-card p-3 bg-light rounded">
                                    <small class="text-muted">Mean Eye-Open Duration</small>
                                    <h4 id="meanIbi" class="mb-0 text-primary">0.0s</h4>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="metric-card p-3 bg-light rounded">
                                    <small class="text-muted">Max Eye-Open Duration</small>
                                    <h4 id="maxEyeOpen" class="mb-0 text-primary">0.0s</h4>
                                </div>
                            </div>
                        </div>

                        <!-- Interpretation -->
                        <div class="alert alert-light border-start border-info ps-3" id="interpretation">
                            <small><strong>Interpretation:</strong> Dry eye risk assessment based on blink patterns. Low blink rates or long eye-open durations may indicate possible dryness.</small>
                        </div>

                        <!-- Timestamp -->
                        <p class="text-muted small mb-4"><i class="bi bi-clock me-1"></i>Analysis Date: <span id="timestamp">--</span></p>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" id="printBtn">
                                <i class="bi bi-printer me-2"></i>Print Results
                            </button>
                            <button type="button" class="btn btn-secondary" id="downloadBtn">
                                <i class="bi bi-download me-2"></i>Download Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Print Template (Hidden) -->
                <div id="printTemplate" style="display: none;">
                    <div style="width: 100%; max-width: 800px; margin: 0 auto; padding: 40px; font-family: Arial, sans-serif;">
                        <!-- Header -->
                        <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #0066cc; padding-bottom: 20px;">
                            <h1 style="color: #0066cc; margin: 0;"><i class="bi bi-eye-fill"></i> NAYAN-AI</h1>
                            <p style="color: #666; margin: 5px 0;">AI-Assisted Eye Screening System</p>
                            <p style="color: #999; font-size: 12px; margin: 5px 0;">Dry Eye Detection Report</p>
                        </div>

                        <!-- Patient Information -->
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #0066cc; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Patient Information</h3>
                            <table style="width: 100%; margin-top: 10px;">
                                <tr>
                                    <td style="padding: 5px; width: 50%;"><strong>Name:</strong> <span id="printPatientName">--</span></td>
                                    <td style="padding: 5px;"><strong>Age:</strong> <span id="printPatientAge">--</span></td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px;"><strong>Gender:</strong> <span id="printPatientGender">--</span></td>
                                    <td style="padding: 5px;"><strong>Date:</strong> <span id="printDate">--</span></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Test Results -->
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #0066cc; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Test Results</h3>
                            <div style="background-color: #f0f8ff; padding: 15px; border-left: 4px solid #0066cc; margin: 15px 0;">
                                <p style="margin: 0;"><strong>Risk Assessment:</strong> <span id="printRiskLabel" style="font-size: 16px; font-weight: bold;">Normal</span></p>
                            </div>
                        </div>

                        <!-- Detailed Metrics -->
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #0066cc; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Detailed Metrics</h3>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <tr style="background-color: #f9f9f9;">
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;"><strong>Metric</strong></th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;"><strong>Value</strong></th>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">Blink Count</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;" id="printBlinkCount">0</td>
                                </tr>
                                <tr style="background-color: #f9f9f9;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">Blink Rate (BPM)</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;" id="printBlinkRate">0.0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">Mean Eye-Open Duration</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;" id="printMeanIbi">0.0s</td>
                                </tr>
                                <tr style="background-color: #f9f9f9;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">Max Eye-Open Duration</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;" id="printMaxEyeOpen">0.0s</td>
                                </tr>
                            </table>
                        </div>

                        <!-- Interpretation -->
                        <div style="margin-bottom: 30px; background-color: #f0f0f0; padding: 15px; border-radius: 5px;">
                            <h4 style="color: #0066cc; margin-top: 0;">Interpretation</h4>
                            <p style="margin: 0; color: #333; line-height: 1.6;">Dry eye risk assessment based on blink patterns analysis. Low blink rates or long eye-open durations may indicate possible dryness. This is a screening support tool only and should not be used as a medical diagnosis. Please consult an ophthalmologist for professional evaluation.</p>
                        </div>

                        <!-- Footer -->
                        <div style="border-top: 2px solid #0066cc; padding-top: 20px; text-align: center; color: #999; font-size: 11px;">
                            <p style="margin: 5px 0;"><strong>NAYAN-AI</strong> - AI-Assisted Eye Screening System</p>
                            <p style="margin: 5px 0;">Developed by: Krishnapriya S, Madhumitha S, Mahalakshmi B S</p>
                            <p style="margin: 5px 0;">Electronics and Communication Engineering Department</p>
                            <p style="margin: 5px 0;">Generated on: <span id="printGeneratedDate">--</span></p>
                            <p style="margin: 10px 0 0 0; font-style: italic;">This report is confidential and intended only for the use of the individual to whom it is addressed.</p>
                        </div>
                    </div>
                </div>

                <!-- Next Button -->
                <div class="text-center mt-4">
                    <a href="history.html" id="nextBtn" style="display: none;" class="btn btn-success">
                        <i class="bi bi-arrow-right me-2"></i>Next: View History
                    </a>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center text-muted small">
            <p class="mb-1"><strong>NAYAN-AI</strong> - AI-Assisted Eye Screening System</p>
            <p class="mb-0">Developed by: Krishnapriya S, Madhumitha S, Mahalakshmi B S</p>
            <p class="mb-0 mt-2">Electronics and Communication Engineering Department</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/dryeye.js"></script>
</body>
</html>
